---
layout: "azurerm"
subcategory: "Compute"
page_title: "Azure Resource Manager: azurerm_virtual_machine_scale_set_extension"
description: |-
  Manages an Extension for a Virtual Machine Scale Set.
---


<!-- Please do not edit this file, it is generated. -->
# azurerm_virtual_machine_scale_set_extension

Manages an Extension for a Virtual Machine Scale Set.

~> **NOTE:** This resource is not intended to be used with the `azurermVirtualMachineScaleSet` resource - instead it's intended for this to be used with the `azurermLinuxVirtualMachineScaleSet` and `azurermWindowsVirtualMachineScaleSet` resources.

## Example Usage

```typescript
import * as constructs from "constructs";
import * as cdktf from "cdktf";
/*Provider bindings are generated by running cdktf get.
See https://cdk.tf/provider-generation for more details.*/
import * as azurerm from "./.gen/providers/azurerm";
class MyConvertedCode extends cdktf.TerraformStack {
  constructor(scope: constructs.Construct, name: string) {
    super(scope, name);
    const azurermResourceGroupExample = new azurerm.resourceGroup.ResourceGroup(
      this,
      "example",
      {
        location: "West Europe",
        name: "example",
      }
    );
    const azurermLinuxVirtualMachineScaleSetExample =
      new azurerm.linuxVirtualMachineScaleSet.LinuxVirtualMachineScaleSet(
        this,
        "example_1",
        {
          adminUsername: "adminuser",
          instances: 1,
          location: cdktf.Token.asString(azurermResourceGroupExample.location),
          name: "example",
          networkInterface: [
            {
              ipConfiguration: [
                {
                  name: "internal",
                },
              ],
              name: "example",
            },
          ],
          osDisk: {
            caching: "ReadWrite",
            storageAccountType: "Standard_LRS",
          },
          resourceGroupName: cdktf.Token.asString(
            azurermResourceGroupExample.name
          ),
          sku: "Standard_F2",
          sourceImageReference: {
            offer: "UbuntuServer",
            publisher: "Canonical",
            sku: "20.04-LTS",
            version: "latest",
          },
        }
      );
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    azurermLinuxVirtualMachineScaleSetExample.overrideLogicalId("example");
    const azurermVirtualMachineScaleSetExtensionExample =
      new azurerm.virtualMachineScaleSetExtension.VirtualMachineScaleSetExtensionA(
        this,
        "example_2",
        {
          name: "example",
          publisher: "Microsoft.Azure.Extensions",
          settings: cdktf.Fn.jsonencode({
            commandToExecute: "echo $HOSTNAME",
          }),
          type: "CustomScript",
          typeHandlerVersion: "2.0",
          virtualMachineScaleSetId: cdktf.Token.asString(
            azurermLinuxVirtualMachineScaleSetExample.id
          ),
        }
      );
    /*This allows the Terraform resource name to match the original name. You can remove the call if you don't need them to match.*/
    azurermVirtualMachineScaleSetExtensionExample.overrideLogicalId("example");
  }
}

```

## Argument Reference

The following arguments are supported:

* `name` - (Required) The name for the Virtual Machine Scale Set Extension. Changing this forces a new resource to be created.

* `virtualMachineScaleSetId` - (Required) The ID of the Virtual Machine Scale Set. Changing this forces a new resource to be created.

-> **NOTE:** This should be the ID from the `azurermLinuxVirtualMachineScaleSet` or `azurermWindowsVirtualMachineScaleSet` resource - when using the older `azurermVirtualMachineScaleSet` resource extensions should instead be defined inline.

* `publisher` - (Required) Specifies the Publisher of the Extension. Changing this forces a new resource to be created.

* `type` - (Required) Specifies the Type of the Extension. Changing this forces a new resource to be created.

* `typeHandlerVersion` - (Required) Specifies the version of the extension to use, available versions can be found using the Azure CLI.

~> **Note:** The `publisher` and `type` of Virtual Machine Scale Set Extensions can be found using the Azure CLI, via:

```shell
az vmss extension image list --location westus -o table
```

---

* `autoUpgradeMinorVersion` - (Optional) Should the latest version of the Extension be used at Deployment Time, if one is available? This won't auto-update the extension on existing installation. Defaults to `true`.

* `automaticUpgradeEnabled` - (Optional) Should the Extension be automatically updated whenever the Publisher releases a new version of this VM Extension? 

* `failureSuppressionEnabled` - (Optional) Should failures from the extension be suppressed? Possible values are `true` or `false`. Defaults to `false`.

-> **NOTE:** Operational failures such as not connecting to the VM will not be suppressed regardless of the `failureSuppressionEnabled` value.

* `forceUpdateTag` - (Optional) A value which, when different to the previous value can be used to force-run the Extension even if the Extension Configuration hasn't changed.

* `protectedSettings` - (Optional) A JSON String which specifies Sensitive Settings (such as Passwords) for the Extension.

~> **NOTE:** Keys within the `protectedSettings` block are notoriously case-sensitive, where the casing required (e.g. TitleCase vs snakeCase) depends on the Extension being used. Please refer to the documentation for the specific Virtual Machine Extension you're looking to use for more information.

* `protectedSettingsFromKeyVault` - (Optional) A `protectedSettingsFromKeyVault` block as defined below.

~> **Note:** `protectedSettingsFromKeyVault` cannot be used with `protectedSettings`

* `provisionAfterExtensions` - (Optional) An ordered list of Extension names which this should be provisioned after.

* `settings` - (Optional) A JSON String which specifies Settings for the Extension.

~> **NOTE:** Keys within the `settings` block are notoriously case-sensitive, where the casing required (e.g. TitleCase vs snakeCase) depends on the Extension being used. Please refer to the documentation for the specific Virtual Machine Extension you're looking to use for more information.

---

A `protectedSettingsFromKeyVault` block supports the following:

* `secretUrl` - (Required) The URL to the Key Vault Secret which stores the protected settings.

* `sourceVaultId` - (Required) The ID of the source Key Vault.

## Attributes Reference

In addition to the Arguments listed above - the following Attributes are exported:

* `id` - The ID of the Virtual Machine Scale Set Extension.

## Timeouts

The `timeouts` block allows you to specify [timeouts](https://www.terraform.io/language/resources/syntax#operation-timeouts) for certain actions:

* `create` - (Defaults to 30 minutes) Used when creating the Virtual Machine Scale Set Extension.
* `update` - (Defaults to 30 minutes) Used when updating the Virtual Machine Scale Set Extension.
* `read` - (Defaults to 5 minutes) Used when retrieving the Virtual Machine Scale Set Extension.
* `delete` - (Defaults to 30 minutes) Used when deleting the Virtual Machine Scale Set Extension.

## Import

Virtual Machine Scale Set Extensions can be imported using the `resource id`, e.g.

```shell
terraform import azurerm_virtual_machine_scale_set_extension.test /subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/group1/providers/Microsoft.Compute/virtualMachineScaleSets/scaleSet1/extensions/extension1
```

<!-- cache-key: cdktf-0.17.0-pre.15 input-c6a4916c3de75ac73bc158da787160de21256842d805820734d476a0a8f96fdb -->